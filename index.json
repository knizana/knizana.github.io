[{"content":"","date":"20 January 2024","permalink":"/","section":"","summary":"","title":""},{"content":"","date":"20 January 2024","permalink":"/post/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":"20 January 2024","permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":"","date":"20 January 2024","permalink":"/tags/test/","section":"Tags","summary":"","title":"test"},{"content":"搭建2个Pod，分别是wordpress和mysql，外部通过8080端口连接 #\r通过环境变量的方式使用ConfigMap/Secret #\r[root@console ~]# cat b1-cm.yml apiVersion: v1 kind: ConfigMap metadata: name: b1-cm labels: owner: b1 data: WORDPRESS_DB_HOST: mysql WORDPRESS_DB_NAME: wordpress WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: wordpress MYSQL_DATABASE: wordpress MYSQL_ROOT_PASSWORD: a MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress [root@console ~]# cat b1-pod-wordpress-env.yml apiVersion: v1 kind: Pod metadata: name: wordpress labels: owner: b1 spec: nodeName: node-01 containers: - name: wordpress image: wordpress imagePullPolicy: IfNotPresent ports: - containerPort: 80 hostPort: 8080 name: wordpress env: - name: WORDPRESS_DB_HOST valueFrom: configMapKeyRef: name: b1-cm key: WORDPRESS_DB_HOST - name: WORDPRESS_DB_NAME valueFrom: configMapKeyRef: name: b1-cm key: WORDPRESS_DB_NAME - name: WORDPRESS_DB_USER valueFrom: configMapKeyRef: name: b1-cm key: WORDPRESS_DB_USER - name: WORDPRESS_DB_PASSWORD valueFrom: configMapKeyRef: name: b1-cm key: WORDPRESS_DB_PASSWORD [root@console ~]# cat b1-pod-mysql-env.yml apiVersion: v1 kind: Pod metadata: name: mysql labels: owner: b1 spec: nodeName: node-01 containers: - name: mysql image: mysql imagePullPolicy: IfNotPresent ports: - containerPort: 3306 name: mysql env: - name: MYSQL_ROOT_PASSWORD valueFrom: configMapKeyRef: name: b1-cm key: MYSQL_ROOT_PASSWORD - name: MYSQL_DATABASE valueFrom: configMapKeyRef: name: b1-cm key: MYSQL_DATABASE - name: MYSQL_USER valueFrom: configMapKeyRef: name: b1-cm key: MYSQL_USER - name: MYSQL_PASSWORD valueFrom: configMapKeyRef: name: b1-cm key: MYSQL_PASSWORD [root@console ~]# cat b1-service-mysql.yml apiVersion: v1 kind: Service metadata: name: mysql spec: selector: owner: b1 ports: - protocol: TCP port: 3306 targetPort: 3306 kubectl apply -f b1-service-mysql.yml,b1-cm.yml,b1-pod-wordpress-env.yml,b1-pod-mysql-env.yml 以Volume的方式使用ConfigMap/Secret #\r[root@console ~]# cat b1-cm-volume.yml apiVersion: v1 kind: ConfigMap metadata: name: b1-cm-volume labels: owner: b1 data: wp-config.php: | \u0026lt;?php define(\u0026#39;DB_NAME\u0026#39;, \u0026#39;wordpress\u0026#39;); define(\u0026#39;DB_USER\u0026#39;, \u0026#39;wordpress\u0026#39;); define(\u0026#39;DB_PASSWORD\u0026#39;, \u0026#39;wordpress\u0026#39;); define(\u0026#39;DB_HOST\u0026#39;, \u0026#39;mysql\u0026#39;); define(\u0026#39;DB_CHARSET\u0026#39;, \u0026#39;utf8\u0026#39;); define(\u0026#39;DB_COLLATE\u0026#39;, \u0026#39;\u0026#39;); define(\u0026#39;AUTH_KEY\u0026#39;, \u0026#39;kn\u0026#39;); define(\u0026#39;SECURE_AUTH_KEY\u0026#39;, \u0026#39;kn\u0026#39;); define(\u0026#39;LOGGED_IN_KEY\u0026#39;, \u0026#39;kn\u0026#39;); define(\u0026#39;NONCE_KEY\u0026#39;, \u0026#39;kn\u0026#39;); define(\u0026#39;AUTH_SALT\u0026#39;, \u0026#39;kn\u0026#39;); define(\u0026#39;SECURE_AUTH_SALT\u0026#39;, \u0026#39;kn\u0026#39;); define(\u0026#39;LOGGED_IN_SALT\u0026#39;, \u0026#39;kn\u0026#39;); define(\u0026#39;NONCE_SALT\u0026#39;, \u0026#39;kn\u0026#39;); $table_prefix = \u0026#39;wp_\u0026#39;; define(\u0026#39;WP_DEBUG\u0026#39;, false); if ( !defined(\u0026#39;ABSPATH\u0026#39;) ) define(\u0026#39;ABSPATH\u0026#39;, dirname(__FILE__) . \u0026#39;/\u0026#39;); require_once(ABSPATH . \u0026#39;wp-settings.php\u0026#39;); ?\u0026gt; mysqlInit.sql: | FLUSH PRIVILEGES; CREATE DATABASE IF NOT EXISTS `wordpress`; CREATE USER IF NOT EXISTS \u0026#39;wordpress\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;wordpress\u0026#39;; GRANT ALL PRIVILEGES ON `wordpress`.* TO \u0026#39;wordpress\u0026#39;@\u0026#39;%\u0026#39;; FLUSH PRIVILEGES; mysqlRootPwd: \u0026#34;1\u0026#34; [root@console ~]# cat b1-pod-wordpress-volume.yml apiVersion: v1 kind: Pod metadata: name: wordpress labels: owner: b1 spec: volumes: - name: cm-vol configMap: name: b1-cm-volume containers: - name: wordpress image: wordpress imagePullPolicy: IfNotPresent ports: - containerPort: 80 hostPort: 8080 volumeMounts: - mountPath: /var/www/html/wp-config.php subPath: wp-config.php name: cm-vol [root@console ~]# cat b1-pod-mysql-volume.yml apiVersion: v1 kind: Pod metadata: name: mysql labels: owner: b1 spec: volumes: - name: cm-vol configMap: name: b1-cm-volume containers: - name: mysql image: mysql imagePullPolicy: IfNotPresent ports: - containerPort: 3306 volumeMounts: - name: cm-vol mountPath: /docker-entrypoint-initdb.d/mysqlInit.sql subPath: mysqlInit.sql env: - name: MYSQL_ROOT_PASSWORD valueFrom: configMapKeyRef: name: b1-cm-volume key: mysqlRootPwd [root@console ~]# cat b1-service-mysql.yml apiVersion: v1 kind: Service metadata: name: mysql spec: selector: owner: b1 ports: - protocol: TCP port: 3306 targetPort: 3306 kubectl apply -f b1-service-mysql.yml,b1-cm-volume.yml,b1-pod-wordpress-volume.yml,b1-pod-mysql-volume.yml 以Volume的方式使用ConfigMap/Secret,但是只有1个pod #\r[root@console ~]# cat b1/combine.yml apiVersion: v1 kind: Pod metadata: name: wordpress labels: owner: b1 spec: nodeName: node-01 containers: - name: mysql image: mysql imagePullPolicy: IfNotPresent ports: - containerPort: 3306 name: mysql env: - name: MYSQL_ROOT_PASSWORD valueFrom: configMapKeyRef: name: b1-cm key: MYSQL_ROOT_PASSWORD - name: MYSQL_DATABASE valueFrom: configMapKeyRef: name: b1-cm key: MYSQL_DATABASE - name: MYSQL_USER valueFrom: configMapKeyRef: name: b1-cm key: MYSQL_USER - name: MYSQL_PASSWORD valueFrom: configMapKeyRef: name: b1-cm key: MYSQL_PASSWORD - name: wordpress image: wordpress imagePullPolicy: IfNotPresent ports: - containerPort: 80 hostPort: 8080 name: wordpress env: - name: WORDPRESS_DB_HOST valueFrom: configMapKeyRef: name: b1-cm key: WORDPRESS_DB_HOST - name: WORDPRESS_DB_NAME valueFrom: configMapKeyRef: name: b1-cm key: WORDPRESS_DB_NAME - name: WORDPRESS_DB_USER valueFrom: configMapKeyRef: name: b1-cm key: WORDPRESS_DB_USER - name: WORDPRESS_DB_PASSWORD valueFrom: configMapKeyRef: name: b1-cm key: WORDPRESS_DB_PASSWORD ","date":"20 January 2024","permalink":"/post/test-kubernetswordpressmysql/","section":"Posts","summary":"搭建2个Pod，分别是wordpress和mysql，外部通过8080端口连接","title":"记录一次Pod搭建及关联练习"},{"content":"1 #\rlong time\n","date":"13 January 2024","permalink":"/post/20240113-test/","section":"Posts","summary":"te te tes","title":"1 post"},{"content":"","date":"1 January 0001","permalink":"/authors/","section":"Authors","summary":"","title":"Authors"},{"content":"","date":"1 January 0001","permalink":"/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":"1 January 0001","permalink":"/series/","section":"Series","summary":"","title":"Series"}]